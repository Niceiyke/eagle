{% extends "base.html" %}

{% block title %}{{ title }}{% endblock %}

{% block header %}
<div class="flex justify-between items-center">
    <h1 class="text-2xl font-semibold text-gray-900">{{ title }}</h1>
    <a href="{{ admin_path }}/{{ model_name }}" class="inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
        <i class="fas fa-arrow-left mr-2"></i> Back to List
    </a>
</div>
{% endblock %}

{% block content %}
<div class="bg-white shadow overflow-hidden sm:rounded-lg">
    <div class="px-4 py-5 sm:p-6">
        <form method="POST" action="{{ admin_path }}/{{ model_name }}{% if item %}/{{ item.id }}/update{% else %}/create{% endif %}" class="space-y-6">
            {% for field in fields %}
            {% if not field.primary_key %}
            <div class="mb-4">
                <label for="{{ field.name }}" class="block text-sm font-medium text-gray-700">
                    {{ field.name|title }}
                    {% if not field.nullable %}<span class="text-red-500">*</span>{% endif %}
                </label>
                {% if field.type in ['str', 'String'] %}
                    <input type="text" name="{{ field.name }}" id="{{ field.name }}" 
                           value="{{ item[field.name] if item else '' }}" 
                           class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                           {% if not field.nullable %}required{% endif %}>
                {% elif field.type in ['int', 'Integer'] %}
                    <input type="number" name="{{ field.name }}" id="{{ field.name }}" 
                           value="{{ item[field.name] if item else '' }}" 
                           class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                           {% if not field.nullable %}required{% endif %}>
                {% elif field.type in ['bool', 'Boolean'] %}
                    <div class="mt-2">
                        <input type="checkbox" name="{{ field.name }}" id="{{ field.name }}" 
                               class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"
                               {% if item and item[field.name] %}checked{% endif %}>
                    </div>
                {% elif field.type in ['datetime', 'DateTime'] %}
                    <input type="datetime-local" name="{{ field.name }}" id="{{ field.name }}" 
                           value="{{ item[field.name].strftime('%Y-%m-%dT%H:%M') if item and item[field.name] else '' }}" 
                           class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                           {% if not field.nullable %}required{% endif %}>
                {% else %}
                    <input type="text" name="{{ field.name }}" id="{{ field.name }}" 
                           value="{{ item[field.name] if item else '' }}" 
                           class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                           {% if not field.nullable %}required{% endif %}>
                {% endif %}
            </div>
            {% endif %}
            {% endfor %}
            
            <div class="flex justify-end space-x-3 pt-4">
                <a href="{{ admin_path }}/{{ model_name }}" class="bg-white py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                    Cancel
                </a>
                <button type="submit" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                    <i class="fas fa-save mr-2"></i> Save
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Convert checkbox values to proper boolean values
    document.querySelectorAll('form').forEach(form => {
        form.addEventListener('submit', function(e) {
            this.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                if (!checkbox.hasAttribute('checked') && !checkbox.checked) {
                    checkbox.value = 'off';
                }
            });
        });
    });
</script>
{% endblock %}
